/*! Editor.md v2.0.1 | editormd.amd.min.js | Open source online markdown editor. | MIT License | By: Pandao | https://github.com/pandao/editor.md | 2018-10-26 */
"use strict";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){if("function"==typeof require&&"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"===("undefined"==typeof module?"undefined":_typeof(module)))module.exports=e;else if("function"==typeof define)if(define.amd){var t="codemirror/mode/",r="codemirror/addon/",n=["jquery","marked","prettify","katex","raphael","underscore","flowchart","jqueryflowchart","sequenceDiagram","codemirror/lib/codemirror",t+"css/css",t+"sass/sass",t+"shell/shell",t+"sql/sql",t+"clike/clike",t+"php/php",t+"xml/xml",t+"markdown/markdown",t+"javascript/javascript",t+"htmlmixed/htmlmixed",t+"gfm/gfm",t+"http/http",t+"go/go",t+"dart/dart",t+"coffeescript/coffeescript",t+"nginx/nginx",t+"python/python",t+"perl/perl",t+"lua/lua",t+"r/r",t+"ruby/ruby",t+"rst/rst",t+"smartymixed/smartymixed",t+"vb/vb",t+"vbscript/vbscript",t+"velocity/velocity",t+"xquery/xquery",t+"yaml/yaml",t+"erlang/erlang",t+"jade/jade",r+"edit/trailingspace",r+"dialog/dialog",r+"search/searchcursor",r+"search/search",r+"scroll/annotatescrollbar",r+"search/matchesonscrollbar",r+"display/placeholder",r+"edit/closetag",r+"fold/foldcode",r+"fold/foldgutter",r+"fold/indent-fold",r+"fold/brace-fold",r+"fold/xml-fold",r+"fold/markdown-fold",r+"fold/comment-fold",r+"mode/overlay",r+"selection/active-line",r+"edit/closebrackets",r+"display/fullscreen",r+"search/match-highlighter"];define(n,e)}else define(["jquery"],e);else window.editormd=e()}(function(){var e;"function"==typeof define&&define.amd&&(t=arguments[0],marked=arguments[1],prettify=arguments[2],katex=arguments[3],Raphael=arguments[4],_=arguments[5],flowchart=arguments[6],CodeMirror=arguments[9]);var t="undefined"!=typeof jQuery?jQuery:Zepto;if(void 0!==t){var r=function e(t,r){return new e.fn.init(t,r)};r.title=r.$name="Editor.md",r.version="1.5.0",r.homePage="https://pandao.github.io/editor.md/",r.classPrefix="editormd-",r.toolbarModes={full:["undo","redo","|","bold","del","italic","quote","ucwords","uppercase","lowercase","|","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","|","link","reference-link","image","code","preformatted-text","code-block","table","datetime","emoji","html-entities","pagebreak","|","goto-line","watch","preview","fullscreen","clear","search","|","help","info"],simple:["undo","redo","|","bold","del","italic","quote","uppercase","lowercase","|","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","|","watch","preview","fullscreen","|","help","info"],mini:["undo","redo","|","watch","preview","|","help","info"]},r.defaults={mode:"gfm",name:"",value:"",theme:"",editorTheme:"default",previewTheme:"",markdown:"",appendMarkdown:"",width:"100%",height:"100%",path:"./lib/",pluginPath:"",delay:300,autoLoadModules:!0,watch:!0,placeholder:"Enjoy Markdown! coding now...",gotoLine:!0,codeFold:!1,autoHeight:!1,minHeight:"150px",maxHeight:"none",autoFocus:!0,autoCloseTags:!0,searchReplace:!0,syncScrolling:!0,readOnly:!1,tabSize:4,indentUnit:4,lineNumbers:!0,lineWrapping:!0,autoCloseBrackets:!0,showTrailingSpace:!0,matchBrackets:!0,indentWithTabs:!0,styleSelectedText:!0,matchWordHighlight:!0,styleActiveLine:!0,dialogLockScreen:!0,dialogShowMask:!0,dialogDraggable:!0,dialogMaskBgColor:"#fff",dialogMaskOpacity:.1,fontSize:"13px",saveHTMLToTextarea:!1,disabledKeyMaps:[],onload:function(){},onresize:function(){},onchange:function(){},onwatch:null,onunwatch:null,onpreviewing:function(){},onpreviewed:function(){},onfullscreen:function(){},onfullscreenExit:function(){},onscroll:function(){},onpreviewscroll:function(){},imageUpload:!1,imageFormats:["jpg","jpeg","gif","png","bmp","webp"],imageUploadURL:"",crossDomainUpload:!1,uploadCallbackURL:"",resizeImageBeforeUpload:!1,resizeImageMaxWidth:0,resizeImageMaxHeight:0,resizeImageQuality:.7,autoUploadPasteImage:!1,parseAjaxResponse:function(e){return e.status?e.data[0]:null},ajaxUploadHeaders:{},ajaxUploadParams:{},ajaxUploadFileKey:"file",sts:"",stsRequestHeaders:{},stsRequestParams:{},ossImageUploadFolder:"editormd/image",toc:!0,tocm:!1,tocTitle:"",tocDropdown:!1,tocContainer:"",tocStartLevel:1,htmlDecode:!1,pageBreak:!0,atLink:!0,emailLink:!0,taskList:!1,emoji:!1,tex:!1,flowChart:!1,sequenceDiagram:!1,previewCodeHighlight:!0,toolbar:!0,toolbarAutoFixed:!0,toolbarIcons:"full",toolbarTitles:{},toolbarHandlers:{ucwords:function(){return r.toolbarHandlers.ucwords},lowercase:function(){return r.toolbarHandlers.lowercase}},toolbarCustomIcons:{lowercase:'<a href="javascript:;" title="Lowercase" unselectable="on"><i class="fa" name="lowercase" style="font-size:24px;margin-top: -10px;">a</i></a>',ucwords:'<a href="javascript:;" title="ucwords" unselectable="on"><i class="fa" name="ucwords" style="font-size:20px;margin-top: -3px;">Aa</i></a>'},toolbarIconsClass:{undo:"fa-undo",redo:"fa-repeat",bold:"fa-bold",del:"fa-strikethrough",italic:"fa-italic",quote:"fa-quote-left",uppercase:"fa-font",h1:r.classPrefix+"bold",h2:r.classPrefix+"bold",h3:r.classPrefix+"bold",h4:r.classPrefix+"bold",h5:r.classPrefix+"bold",h6:r.classPrefix+"bold","list-ul":"fa-list-ul","list-ol":"fa-list-ol",hr:"fa-minus",link:"fa-link","reference-link":"fa-anchor",image:"fa-picture-o",code:"fa-code","preformatted-text":"fa-file-code-o","code-block":"fa-file-code-o",table:"fa-table",datetime:"fa-clock-o",emoji:"fa-smile-o","html-entities":"fa-copyright",pagebreak:"fa-newspaper-o","goto-line":"fa-terminal",watch:"fa-eye-slash",unwatch:"fa-eye",preview:"fa-desktop",search:"fa-search",fullscreen:"fa-arrows-alt",clear:"fa-eraser",help:"fa-question-circle",info:"fa-info-circle"},toolbarIconTexts:{},lang:{name:"zh-cn",description:"开源在线Markdown编辑器<br/>Open source online Markdown editor.",tocTitle:"目录",toolbar:{undo:"撤销（Ctrl+Z）",redo:"重做（Ctrl+Y）",bold:"粗体",del:"删除线",italic:"斜体",quote:"引用",ucwords:"将每个单词首字母转成大写",uppercase:"将所选转换成大写",lowercase:"将所选转换成小写",h1:"标题1",h2:"标题2",h3:"标题3",h4:"标题4",h5:"标题5",h6:"标题6","list-ul":"无序列表","list-ol":"有序列表",hr:"横线",link:"链接","reference-link":"引用链接",image:"添加图片",code:"行内代码","preformatted-text":"预格式文本 / 代码块（缩进风格）","code-block":"代码块（多语言风格）",table:"添加表格",datetime:"日期时间",emoji:"Emoji表情","html-entities":"HTML实体字符",pagebreak:"插入分页符","goto-line":"跳转到行",watch:"关闭实时预览",unwatch:"开启实时预览",preview:"全窗口预览HTML（按 Shift + ESC还原）",fullscreen:"全屏（按ESC还原）",clear:"清空",search:"搜索",help:"使用帮助",info:"关于"+r.title},buttons:{enter:"确定",cancel:"取消",close:"关闭"},dialog:{link:{title:"添加链接",url:"链接地址",urlTitle:"链接标题",urlEmpty:"错误：请填写链接地址。"},referenceLink:{title:"添加引用链接",name:"引用名称",url:"链接地址",urlId:"链接ID",urlTitle:"链接标题",nameEmpty:"错误：引用链接的名称不能为空。",idEmpty:"错误：请填写引用链接的ID。",urlEmpty:"错误：请填写引用链接的URL地址。"},image:{title:"添加图片",url:"图片地址",link:"图片链接",alt:"图片描述",uploadButton:"本地上传",imageURLEmpty:"错误：图片地址不能为空。",uploadFileEmpty:"错误：上传的图片不能为空。",formatNotAllowed:"错误：只允许上传图片文件，允许上传的图片文件格式有："},preformattedText:{title:"添加预格式文本或代码块",emptyAlert:"错误：请填写预格式文本或代码的内容。"},codeBlock:{title:"添加代码块",selectLabel:"代码语言：",selectDefaultText:"请选择代码语言",otherLanguage:"其他语言",unselectedLanguageAlert:"错误：请选择代码所属的语言类型。",codeEmptyAlert:"错误：请填写代码内容。"},htmlEntities:{title:"HTML 实体字符"},help:{title:"使用帮助"}}}},r.classNames={tex:r.classPrefix+"tex"},r.dialogZindex=99999,r.$katex=null,r.$marked=null,r.$CodeMirror=null,r.$prettyPrint=null;var n,i;r.prototype=r.fn={state:{watching:!1,loaded:!1,preview:!1,fullscreen:!1},init:function(e,n){n=n||{},"object"===_typeof(e)&&(n=e);var i=this.classPrefix=r.classPrefix,o=this.settings=t.extend(!0,r.defaults,n);e="object"===_typeof(e)?o.id:e;var a=this.editor=t("#"+e);this.id=e,this.lang=o.lang;var s=this.classNames={textarea:{html:i+"html-textarea",markdown:i+"markdown-textarea"}};o.pluginPath=""===o.pluginPath?o.path+"../plugins/":o.pluginPath,this.state.watching=!!o.watch,a.hasClass("editormd")||a.addClass("editormd"),a.css({width:"number"==typeof o.width?o.width+"px":o.width,height:"number"==typeof o.height?o.height+"px":o.height}),o.autoHeight&&a.css({height:"auto",minHeight:o.minHeight});var l=this.markdownTextarea=a.children("textarea");l.length<1&&(a.append("<textarea></textarea>"),l=this.markdownTextarea=a.children("textarea")),l.addClass(s.textarea.markdown).attr("placeholder",o.placeholder),void 0!==l.attr("name")&&""!==l.attr("name")||l.attr("name",""!==o.name?o.name:e+"-markdown-doc");var c=[o.readOnly?"":'<a href="javascript:;" class="fa fa-close '+i+'preview-close-btn"></a>',o.saveHTMLToTextarea?'<textarea class="'+s.textarea.html+'" name="'+e+'-html-code"></textarea>':"",'<div class="'+i+'preview"><div class="markdown-body '+i+'preview-container"></div></div>','<div class="'+i+'container-mask" style="display:block;"></div>','<div class="'+i+'mask"></div>'].join("\n");return a.append(c).addClass(i+"vertical"),""!==o.theme&&a.addClass(i+"theme-"+o.theme),this.mask=a.children("."+i+"mask"),this.containerMask=a.children("."+i+"container-mask"),""!==o.markdown&&l.val(o.markdown),""!==o.appendMarkdown&&l.val(l.val()+o.appendMarkdown),this.htmlTextarea=a.children("."+s.textarea.html),this.preview=a.children("."+i+"preview"),this.previewContainer=this.preview.children("."+i+"preview-container"),""!==o.previewTheme&&this.preview.addClass(i+"preview-theme-"+o.previewTheme),"function"==typeof define&&define.amd&&("undefined"!=typeof katex&&(r.$katex=katex),o.searchReplace&&!o.readOnly&&(r.loadCSS(o.path+"codemirror/addon/dialog/dialog"),r.loadCSS(o.path+"codemirror/addon/search/matchesonscrollbar"))),"function"==typeof define&&define.amd||!o.autoLoadModules?("undefined"!=typeof CodeMirror&&(r.$CodeMirror=CodeMirror),"undefined"!=typeof marked&&(r.$marked=marked),this.setCodeMirror().setToolbar().loadedDisplay()):this.loadQueues(),this},loadQueues:function(){var e=this,t=this.settings,n=t.path,i=function(){if(r.isIE8)return void e.loadedDisplay();t.flowChart||t.sequenceDiagram?r.loadScript(n+"raphael.min",function(){r.loadScript(n+"underscore.min",function(){!t.flowChart&&t.sequenceDiagram?r.loadScript(n+"sequence-diagram.min",function(){e.loadedDisplay()}):t.flowChart&&!t.sequenceDiagram?r.loadScript(n+"flowchart.min",function(){r.loadScript(n+"jquery.flowchart.min",function(){e.loadedDisplay()})}):t.flowChart&&t.sequenceDiagram&&r.loadScript(n+"flowchart.min",function(){r.loadScript(n+"jquery.flowchart.min",function(){r.loadScript(n+"sequence-diagram.min",function(){e.loadedDisplay()})})})})}):e.loadedDisplay()};return r.loadCSS(n+"codemirror/codemirror.min"),t.searchReplace&&!t.readOnly&&(r.loadCSS(n+"codemirror/addon/dialog/dialog"),r.loadCSS(n+"codemirror/addon/search/matchesonscrollbar")),t.codeFold&&r.loadCSS(n+"codemirror/addon/fold/foldgutter"),r.loadScript(n+"codemirror/codemirror.min",function(){r.$CodeMirror=CodeMirror,r.loadScript(n+"codemirror/modes.min",function(){r.loadScript(n+"codemirror/addons.min",function(){if(e.setCodeMirror(),"gfm"!==t.mode&&"markdown"!==t.mode)return e.loadedDisplay(),!1;e.setToolbar(),r.loadScript(n+"marked.min",function(){r.$marked=marked,t.previewCodeHighlight?r.loadScript(n+"prettify.min",function(){i()}):i()})})})}),t.imageUpload&&(t.resizeImageBeforeUpload&&r.loadScript(n+"localResizeIMG/lrz.bundle"),t.sts&&r.loadScript(n+"aliyun-oss-sdk.min"),t.autoUploadPasteImage&&this.editor.on("paste",function(r){e.uploadPaste(r,t)})),this},setTheme:function(e){var t=this.editor,r=this.settings.theme,n=this.classPrefix+"theme-";return t.removeClass(n+r).addClass(n+e),this.settings.theme=e,this},setEditorTheme:function(e){var t=this.settings;return t.editorTheme=e,"default"!==e&&r.loadCSS(t.path+"codemirror/theme/"+t.editorTheme),this.cm.setOption("theme",e),this},setCodeMirrorTheme:function(e){return this.setEditorTheme(e),this},setPreviewTheme:function(e){var t=this.preview,r=this.settings.previewTheme,n=this.classPrefix+"preview-theme-";return t.removeClass(n+r).addClass(n+e),this.settings.previewTheme=e,this},setCodeMirror:function(){var e=this.settings,t=this.editor;"default"!==e.editorTheme&&r.loadCSS(e.path+"codemirror/theme/"+e.editorTheme);var n={mode:e.mode,theme:e.editorTheme,tabSize:e.tabSize,dragDrop:!1,autofocus:e.autoFocus,autoCloseTags:e.autoCloseTags,readOnly:!!e.readOnly&&"nocursor",indentUnit:e.indentUnit,lineNumbers:e.lineNumbers,lineWrapping:e.lineWrapping,extraKeys:{"Ctrl-Q":function(e){e.foldCode(e.getCursor())}},foldGutter:e.codeFold,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],matchBrackets:e.matchBrackets,indentWithTabs:e.indentWithTabs,styleActiveLine:e.styleActiveLine,styleSelectedText:e.styleSelectedText,autoCloseBrackets:e.autoCloseBrackets,showTrailingSpace:e.showTrailingSpace,highlightSelectionMatches:!!e.matchWordHighlight&&{showToken:"onselected"!==e.matchWordHighlight&&/\w/}};return this.codeEditor=this.cm=r.$CodeMirror.fromTextArea(this.markdownTextarea[0],n),this.codeMirror=this.cmElement=t.children(".CodeMirror"),""!==e.value&&this.cm.setValue(e.value),this.codeMirror.css({fontSize:e.fontSize,width:e.watch?"50%":"100%"}),e.autoHeight&&(this.codeMirror.css({height:"auto",minHeight:e.minHeight,maxHeight:e.maxHeight}),this.codeMirror.find(".CodeMirror-gutters").css({minHeight:e.minHeight}),this.codeMirror.find(".CodeMirror-scroll").css({minHeight:e.minHeight,maxHeight:e.maxHeight}),this.cm.setOption("viewportMargin",1/0)),e.lineNumbers||this.codeMirror.find(".CodeMirror-gutters").css("border-right","none"),this},uploadPaste:function(e,t){var r,n,i,o=this,a=e.originalEvent.clipboardData||window.clipboardData;if(a){if(!(r=a.items))return;i=a.types||[];for(var s=0;s<i.length;s++)if("Files"===i[s]){n=r[s];break}if(2===i.length&&"text/plain"===i[0]&&"Files"===i[1]&&n&&"file"===n.kind&&n.type.match(/^image\//i)){e.stopPropagation(),e.preventDefault();var l=new RegExp("(\\.("+t.imageFormats.join("|")+"))$"),c=a.getData("text/plain");if(!l.test(c))return void alert(this.lang.dialog.image.formatNotAllowed+t.imageFormats.join(", "));var u=n.getAsFile(),d=o.cm.getCursor(),f="【上传中...】";o.insertValue(f);var m=o.cm.getCursor();if(t.resizeImageBeforeUpload){var h=new FileReader;h.readAsDataURL(u),h.onload=function(){var e={};t.resizeImageMaxWidth>0&&(e.width=t.resizeImageMaxWidth),t.resizeImageMaxHeight>0&&(e.height=t.resizeImageMaxHeight),lrz(h.result,e).then(function(e){t.sts?o.ossUpload(e.file,"image",function(e,t){var r=o.getCursor();o.setSelection(d,m);var n;e?n="!["+c+"]("+t+")":(console.error(t),n="【上传失败】"),o.replaceSelection(n),r.line===o.getCursor().line&&(r.ch+=n.length-f.length),o.setCursor(r)}):o.ajaxUpload(e.file,function(e,r){var n=o.getCursor();o.setSelection(d,m);var i;if(e){var a=t.parseAjaxResponse(r);i=a?"!["+c+"]("+a+")":"【上传失败】"}else console.error(r),i="【上传失败】",o.replaceSelection(i);o.replaceSelection(i),n.line===o.getCursor().line&&(n.ch+=i.length-f.length),o.setCursor(n)})})}}else t.sts?o.ossUpload(u,"image",function(e,t){var r=o.getCursor();o.setSelection(d,m);var n;e?n="!["+c+"]("+t+")":(console.error(t),n="【上传失败】"),o.replaceSelection(n),r.line===o.getCursor().line&&(r.ch+=n.length-f.length),o.setCursor(r)}):o.ajaxUpload(u,function(e,r){var n=o.getCursor();o.setSelection(d,m);var i;if(e){var a=t.parseAjaxResponse(r);i=a?"!["+c+"]("+a+")":"【上传失败】"}else console.error(r),i="【上传失败】";o.replaceSelection(i),n.line===o.getCursor().line&&(n.ch+=i.length-f.length),o.setCursor(n)})}}},fileNameGenerator:function(e){var t=new Date;return t.getFullYear()+(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+t.getDate()+(t.getHours()+1<10?"0"+(t.getHours()+1):t.getHours()+1)+(t.getMinutes()+1<10?"0"+(t.getMinutes()+1):t.getMinutes()+1)+(t.getSeconds()+1<10?"0"+(t.getSeconds()+1):t.getSeconds()+1)+(new Date).getTime()+e.substring(e.lastIndexOf("."),e.length)},_cachedStsToken:null,_stsTokenRequest:function(e){var r=this,n=this.settings,i=this;t.ajax({url:n.sts,method:"post",data:n.stsRequestParams,dataType:"json",beforeSend:function(e){for(var t=n.stsRequestHeaders,r=Object.keys(n.stsRequestHeaders),i=0;i<r.length;i++)e.setRequestHeader(r[i],t[r[i]])},success:function(t){if(t.status){var n=t.data,o=new Date(n.expiration).valueOf();n.expirationTimes=+o,i._cachedToken=n,e(r._cachedToken)}else alert("获取Token失败")},error:function(e){console.error(e),alert("获取Token失败")}})},stsToken:function(e){this._cachedStsToken?this._cachedStsToken.expirationTimes<=(new Date).valueOf()-3e5?this._stsTokenRequest(e):e(this._cachedStsToken):this._stsTokenRequest(e)},ossUpload:function(e,t,r){var n,i=e.name;"image"===t&&(i&&-1!==i.indexOf(".")||(i="image.jpeg"),n=this.settings.ossImageUploadFolder+"/"+this.fileNameGenerator(i)),this.stsToken(function(t){new OSS({accessKeyId:t.accessKeyId,accessKeySecret:t.accessKeySecret,stsToken:t.securityToken,bucket:t.bucket,endpoint:t.endpoint,region:t.region}).multipartUpload(n,e).then(function(e){if(r){var t=e.res.requestUrls[0];t=-1!==t.indexOf("?")?t.substring(0,t.indexOf("?")):t,r(!0,t)}}).catch(function(e){r&&r(!1,e)})})},ajaxUpload:function(e,r){var n=this.settings,i=new FormData;i.append(n.ajaxUploadFileKey,e);for(var o=n.ajaxUploadParams,a=Object.keys(o),s=0;s<a.length;s++)i.append(a[s],o[a[s]]);t.ajax({url:n.imageUploadURL,type:"post",cache:!1,data:i,processData:!1,contentType:!1,dataType:"json",beforeSend:function(e){for(var t=n.ajaxUploadHeaders,r=Object.keys(n.ajaxUploadHeaders),i=0;i<r.length;i++)e.setRequestHeader(r[i],t[r[i]])},success:function(e){r&&r(!0,e)},error:function(e){r&&r(!1,e)}})},getCodeMirrorOption:function(e){return this.cm.getOption(e)},setCodeMirrorOption:function(e,t){return this.cm.setOption(e,t),this},addKeyMap:function(e,t){return this.cm.addKeyMap(e,t),this},removeKeyMap:function(e){return this.cm.removeKeyMap(e),this},gotoLine:function(e){var r=this.settings;if(!r.gotoLine)return this;var n=this.cm,i=(this.editor,n.lineCount()),o=this.preview;if("string"==typeof e&&("last"===e&&(e=i),"first"===e&&(e=1)),"number"!=typeof e)return alert("Error: The line number must be an integer."),this;if((e=parseInt(e)-1)>i)return alert("Error: The line number range 1-"+i),this;n.setCursor({line:e,ch:0});var a=n.getScrollInfo(),s=a.clientHeight,l=n.charCoords({line:e,ch:0},"local");if(n.scrollTo(null,(l.top+l.bottom-s)/2),r.watch){var c=this.codeMirror.find(".CodeMirror-scroll")[0],u=t(c).height(),d=c.scrollTop,f=d/c.scrollHeight;0===d?o.scrollTop(0):d+u>=c.scrollHeight-16?o.scrollTop(o[0].scrollHeight):o.scrollTop(o[0].scrollHeight*f)}return n.focus(),this},extend:function(){return void 0!==arguments[1]&&("function"==typeof arguments[1]&&(arguments[1]=t.proxy(arguments[1],this)),this[arguments[0]]=arguments[1]),"object"===_typeof(arguments[0])&&void 0===arguments[0].length&&t.extend(!0,this,arguments[0]),this},set:function(e,r){return void 0!==r&&"function"==typeof r&&(r=t.proxy(r,this)),this[e]=r,this},config:function(e,r){var n=this.settings;return"object"===_typeof(e)&&(n=t.extend(!0,n,e)),"string"==typeof e&&(n[e]=r),this.settings=n,this.recreate(),this},on:function(e,r){var n=this.settings;return void 0!==n["on"+e]&&(n["on"+e]=t.proxy(r,this)),this},off:function(e){var t=this.settings;return void 0!==t["on"+e]&&(t["on"+e]=function(){}),this},showToolbar:function(e){var r=this.settings;return r.readOnly?this:(r.toolbar&&(this.toolbar.length<1||""===this.toolbar.find("."+this.classPrefix+"menu").html())&&this.setToolbar(),r.toolbar=!0,this.toolbar.show(),this.resize(),t.proxy(e||function(){},this)(),this)},hideToolbar:function(e){return this.settings.toolbar=!1,this.toolbar.hide(),this.resize(),t.proxy(e||function(){},this)(),this},setToolbarAutoFixed:function(e){var r=this.state,n=this.editor,i=this.toolbar,o=this.settings;void 0!==e&&(o.toolbarAutoFixed=e);var a=function(){var e=t(window),r=e.scrollTop();if(!o.toolbarAutoFixed)return!1;r-n.offset().top>10&&r<n.height()?i.css({position:"fixed",width:n.width()+"px",left:(e.width()-n.width())/2+"px"}):i.css({position:"absolute",width:"100%",left:0})};return!r.fullscreen&&!r.preview&&o.toolbar&&o.toolbarAutoFixed&&t(window).bind("scroll",a),this},setToolbar:function(){var e=this.settings;if(e.readOnly)return this;var t=this.editor,n=(this.preview,this.classPrefix),i=this.toolbar=t.children("."+n+"toolbar");if(e.toolbar&&i.length<1){var o='<div class="'+n+'toolbar"><div class="'+n+'toolbar-container"><ul class="'+n+'menu"></ul></div></div>';t.append(o),i=this.toolbar=t.children("."+n+"toolbar")}if(!e.toolbar)return i.hide(),this;i.show();for(var a="function"==typeof e.toolbarIcons?e.toolbarIcons():"string"==typeof e.toolbarIcons?r.toolbarModes[e.toolbarIcons]:e.toolbarIcons,s=i.find("."+this.classPrefix+"menu"),l="",c=!1,u=0,d=a.length;u<d;u++){var f=a[u];if("||"===f)c=!0;else if("|"===f)l+='<li class="divider" unselectable="on">|</li>';else{var m=/h(\d)/.test(f),h=f;"watch"!==f||e.watch||(h="unwatch");var p=e.lang.toolbar[h],g=e.toolbarIconTexts[h],b=e.toolbarIconsClass[h];p=void 0===p?"":p,g=void 0===g?"":g,b=void 0===b?"":b;var v=c?'<li class="pull-right">':"<li>";void 0!==e.toolbarCustomIcons[f]&&"function"!=typeof e.toolbarCustomIcons[f]?v+=e.toolbarCustomIcons[f]:(v+='<a href="javascript:;" title="'+p+'" unselectable="on">',v+='<i class="fa '+b+'" name="'+f+'" unselectable="on">'+(m?f.toUpperCase():""===b?g:"")+"</i>",v+="</a>"),v+="</li>",l=c?v+l:l+v}}return s.html(l),s.find('[title="Lowercase"]').attr("title",e.lang.toolbar.lowercase),s.find('[title="ucwords"]').attr("title",e.lang.toolbar.ucwords),this.setToolbarHandler(),this.setToolbarAutoFixed(),this},dialogLockScreen:function(){return t.proxy(r.dialogLockScreen,this)(),this},dialogShowMask:function(e){return t.proxy(r.dialogShowMask,this)(e),this},getToolbarHandles:function(e){var t=this.toolbarHandlers=r.toolbarHandlers;return e&&void 0!==toolbarIconHandlers[e]?t[e]:t},setToolbarHandler:function(){var e=this,n=this.settings;if(!n.toolbar||n.readOnly)return this;var i=this.toolbar,o=this.cm,a=this.classPrefix,s=this.toolbarIcons=i.find("."+a+"menu > li > a"),l=this.getToolbarHandles();return s.bind(r.mouseOrTouch("click","touchend"),function(r){var i=t(this).children(".fa"),a=i.attr("name"),s=o.getCursor(),c=o.getSelection();if(""!==a)return e.activeIcon=i,void 0!==l[a]?t.proxy(l[a],e)(o):void 0!==n.toolbarHandlers[a]&&t.proxy(n.toolbarHandlers[a],e)(o,i,s,c),"link"!==a&&"reference-link"!==a&&"image"!==a&&"code-block"!==a&&"preformatted-text"!==a&&"watch"!==a&&"preview"!==a&&"search"!==a&&"fullscreen"!==a&&"info"!==a&&o.focus(),!1}),this},createDialog:function(e){return t.proxy(r.createDialog,this)(e)},createInfoDialog:function(){var e=this,t=this.editor,n=this.classPrefix,i=['<div class="'+n+"dialog "+n+'dialog-info" style="">','<div class="'+n+'dialog-container">','<h1><i class="editormd-logo editormd-logo-lg editormd-logo-color"></i> '+r.title+"<small>v"+r.version+"</small></h1>","<p>"+this.lang.description+"</p>",'<p style="margin: 10px 0 20px 0;"><a href="'+r.homePage+'" target="_blank">'+r.homePage+' <i class="fa fa-external-link"></i></a></p>','<p style="font-size: 0.85em;">Copyright &copy; 2015 <a href="https://github.com/pandao" target="_blank" class="hover-link">Pandao</a>, The <a href="https://github.com/pandao/editor.md/blob/master/LICENSE" target="_blank" class="hover-link">MIT</a> License.</p>',"</div>",'<a href="javascript:;" class="fa fa-close '+n+'dialog-close"></a>',"</div>"].join("\n");t.append(i);var o=this.infoDialog=t.children("."+n+"dialog-info");return o.find("."+n+"dialog-close").bind(r.mouseOrTouch("click","touchend"),function(){e.hideInfoDialog()}),o.css("border",r.isIE8?"1px solid #ddd":"").css("z-index",r.dialogZindex).show(),this.infoDialogPosition(),this},infoDialogPosition:function(){var e=this.infoDialog,r=function(){e.css({top:(t(window).height()-e.height())/2+"px",left:(t(window).width()-e.width())/2+"px"})};return r(),t(window).resize(r),this},showInfoDialog:function(){t("html,body").css("overflow-x","hidden");var e=this.editor,n=this.settings,i=this.infoDialog=e.children("."+this.classPrefix+"dialog-info");return i.length<1&&this.createInfoDialog(),this.lockScreen(!0),this.mask.css({opacity:n.dialogMaskOpacity,backgroundColor:n.dialogMaskBgColor}).show(),i.css("z-index",r.dialogZindex).show(),this.infoDialogPosition(),this},hideInfoDialog:function(){return t("html,body").css("overflow-x",""),this.infoDialog.hide(),this.mask.hide(),this.lockScreen(!1),this},lockScreen:function(e){return r.lockScreen(e),this.resize(),this},recreate:function(){var e=this.editor,t=this.settings;return this.codeMirror.remove(),this.setCodeMirror(),t.readOnly||(e.find(".editormd-dialog").length>0&&e.find(".editormd-dialog").remove(),t.toolbar&&(this.getToolbarHandles(),this.setToolbar())),this.loadedDisplay(!0),this},previewCodeHighlight:function(){var e=this.settings,t=this.previewContainer;return e.previewCodeHighlight&&(t.find("pre").addClass("prettyprint linenums"),"undefined"!=typeof prettyPrint&&prettyPrint()),this},katexRender:function(){return null===n?this:(this.previewContainer.find("."+r.classNames.tex).each(function(){var e=t(this);r.$katex.render(e.text(),e[0]),e.find(".katex").css("font-size","1.6em")}),this)},flowChartAndSequenceDiagramRender:function(){var e=this,n=this.settings,o=this.previewContainer;if(r.isIE8)return this;if(n.flowChart){if(null===i)return this;o.find(".flowchart").flowChart()}n.sequenceDiagram&&o.find(".sequence-diagram").sequenceDiagram({theme:"simple"});var a=e.preview,s=e.codeMirror,l=s.find(".CodeMirror-scroll"),c=l.height(),u=l.scrollTop(),d=u/l[0].scrollHeight,f=0;a.find(".markdown-toc-list").each(function(){f+=t(this).height()});var m=a.find(".editormd-toc-menu").height();return m=m||0,n.syncScrolling&&(0===u?a.scrollTop(0):u+c>=l[0].scrollHeight-16?a.scrollTop(a[0].scrollHeight):a.scrollTop((a[0].scrollHeight+f+m)*d)),this},registerKeyMaps:function(e){var n=this,i=this.cm,o=this.settings,a=r.toolbarHandlers,s=o.disabledKeyMaps;if(e=e||null){for(var l in e)if(t.inArray(l,s)<0){var c={};c[l]=e[l],i.addKeyMap(e)}}else{for(var u in r.keyMaps){var d=r.keyMaps[u],f="string"==typeof d?t.proxy(a[d],n):t.proxy(d,n);if(t.inArray(u,["F9","F10","F11"])<0&&t.inArray(u,s)<0){var m={};m[u]=f,i.addKeyMap(m)}}t(window).keydown(function(e){var r={120:"F9",121:"F10",122:"F11"};if(t.inArray(r[e.keyCode],s)<0)switch(e.keyCode){case 120:return t.proxy(a.watch,n)(),!1;case 121:return t.proxy(a.preview,n)(),!1;case 122:return t.proxy(a.fullscreen,n)(),!1}})}return this},bindScrollEvent:function(){var e=this,n=this.preview,i=this.settings,o=this.codeMirror,a=r.mouseOrTouch;if(!i.syncScrolling)return this;var s=function(){o.find(".CodeMirror-scroll").bind(a("scroll","touchmove"),function(r){var o=t(this).height(),a=t(this).scrollTop(),s=a/t(this)[0].scrollHeight,l=0;n.find(".markdown-toc-list").each(function(){l+=t(this).height()});var c=n.find(".editormd-toc-menu").height();c=c||0,0===a?n.scrollTop(0):a+o>=t(this)[0].scrollHeight-16?n.scrollTop(n[0].scrollHeight):n.scrollTop((n[0].scrollHeight+l+c)*s),t.proxy(i.onscroll,e)(r)})},l=function(){o.find(".CodeMirror-scroll").unbind(a("scroll","touchmove"))},c=function(){n.bind(a("scroll","touchmove"),function(r){var n=t(this).height(),a=t(this).scrollTop(),s=a/t(this)[0].scrollHeight,l=o.find(".CodeMirror-scroll");0===a?l.scrollTop(0):a+n>=t(this)[0].scrollHeight?l.scrollTop(l[0].scrollHeight):l.scrollTop(l[0].scrollHeight*s),t.proxy(i.onpreviewscroll,e)(r)})},u=function(){n.unbind(a("scroll","touchmove"))};return o.bind({mouseover:s,mouseout:l,touchstart:s,touchend:l}),"single"===i.syncScrolling?this:(n.bind({mouseover:c,mouseout:u,touchstart:c,touchend:u}),this)},bindChangeEvent:function(){var e=this,t=this.cm,r=this.settings;return t.on("change",function(t,i){r.watch&&e.previewContainer.css("padding",r.autoHeight?"20px 20px 50px 40px":"20px"),n=setTimeout(function(){clearTimeout(n),e.save(),n=null},r.delay)}),this},loadedDisplay:function(e){e=e||!1;var r=this,n=this.editor,i=this.preview,o=this.settings;return this.containerMask.hide(),this.save(),o.watch&&i.show(),n.data("oldWidth",n.width()).data("oldHeight",n.height()),this.resize(),this.registerKeyMaps(),t(window).resize(function(){r.resize()}),this.bindScrollEvent().bindChangeEvent(),e||t.proxy(o.onload,this)(),this.state.loaded=!0,this},width:function(e){return this.editor.css("width","number"==typeof e?e+"px":e),this.resize(),this},height:function(e){return this.editor.css("height","number"==typeof e?e+"px":e),this.resize(),this},resize:function(e,r){e=e||null,r=r||null;var n=this.state,i=this.editor,o=this.preview,a=this.toolbar,s=this.settings,l=this.codeMirror;if(e&&i.css("width","number"==typeof e?e+"px":e),!s.autoHeight||n.fullscreen||n.preview?(r&&i.css("height","number"==typeof r?r+"px":r),n.fullscreen&&i.height(t(window).height()),s.toolbar&&!s.readOnly?l.css("margin-top",a.height()+1).height(i.height()-a.height()):l.css("margin-top",0).height(i.height())):(i.css({height:"auto",minHeight:s.minHeight}),l.css({height:"auto",minHeight:s.minHeight,maxHeight:s.maxHeight})),s.watch)if(l.width(i.width()/2),o.width(n.preview?i.width():i.width()/2),this.previewContainer.css("padding",s.autoHeight?"20px 20px 50px 40px":"20px"),s.toolbar&&!s.readOnly?o.css("top",a.height()+1):o.css("top",0),!s.autoHeight||n.fullscreen||n.preview){var c=s.toolbar&&!s.readOnly?i.height()-a.height():i.height();o.height(c)}else o.height("");else l.width(i.width()),o.hide();return n.loaded&&t.proxy(s.onresize,this)(),this},save:function(){if(null===n)return this;var e=this,o=this.state,a=this.settings,s=this.cm,l=s.getValue(),c=this.previewContainer;if("gfm"!==a.mode&&"markdown"!==a.mode)return this.markdownTextarea.val(l),this;var u=r.$marked,d=this.markdownToC=[],f=this.markedRendererOptions={toc:a.toc,tocm:a.tocm,tocStartLevel:a.tocStartLevel,pageBreak:a.pageBreak,taskList:a.taskList,emoji:a.emoji,tex:a.tex,atLink:a.atLink,emailLink:a.emailLink,flowChart:a.flowChart,sequenceDiagram:a.sequenceDiagram,previewCodeHighlight:a.previewCodeHighlight},m=this.markedOptions={renderer:r.markedRenderer(d,f),gfm:!0,tables:!0,breaks:!0,pedantic:!1,sanitize:!a.htmlDecode,smartLists:!0,smartypants:!0};u.setOptions(m);var h=r.$marked(l,m);if(h=r.filterHTMLTags(h,a.htmlDecode),this.markdownTextarea.text(l),s.save(),a.saveHTMLToTextarea&&this.htmlTextarea.text(h),a.watch||!a.watch&&o.preview){if(c.html(h),this.previewCodeHighlight(),a.toc){var p=""===a.tocContainer?c:t(a.tocContainer),g=p.find("."+this.classPrefix+"toc-menu");p.attr("previewContainer",""===a.tocContainer?"true":"false"),""!==a.tocContainer&&g.length>0&&g.remove(),r.markdownToCRenderer(d,p,a.tocDropdown,a.tocStartLevel),(a.tocDropdown||p.find("."+this.classPrefix+"toc-menu").length>0)&&r.tocDropdownMenu(p,""!==a.tocTitle?a.tocTitle:this.lang.tocTitle),""!==a.tocContainer&&c.find(".markdown-toc").css("border","none")}a.tex&&(!r.kaTeXLoaded&&a.autoLoadModules?r.loadKaTeX(function(){r.$katex=katex,r.kaTeXLoaded=!0,e.katexRender()}):(r.$katex=katex,this.katexRender())),(a.flowChart||a.sequenceDiagram)&&(i=setTimeout(function(){clearTimeout(i),e.flowChartAndSequenceDiagramRender(),i=null},10)),o.loaded&&t.proxy(a.onchange,this)()}return this},focus:function(){return this.cm.focus(),this},setCursor:function(e){return this.cm.setCursor(e),this},getCursor:function(){return this.cm.getCursor()},setSelection:function(e,t){return this.cm.setSelection(e,t),this},getSelection:function(){return this.cm.getSelection()},setSelections:function(e){return this.cm.setSelections(e),this},getSelections:function(){return this.cm.getSelections()},replaceSelection:function(e){return this.cm.replaceSelection(e),this},insertValue:function(e){return this.replaceSelection(e),this},appendMarkdown:function(e){var t=(this.settings,this.cm);return t.setValue(t.getValue()+e),this},setMarkdown:function(e){return this.cm.setValue(e||this.settings.markdown),this},getMarkdown:function(){return this.cm.getValue()},getValue:function(){return this.cm.getValue()},setValue:function(e){return this.cm.setValue(e),this},clear:function(){return this.cm.setValue(""),this},getHTML:function(){return this.settings.saveHTMLToTextarea?this.htmlTextarea.val():(alert("Error: settings.saveHTMLToTextarea == false"),!1)},getTextareaSavedHTML:function(){return this.getHTML()},getPreviewedHTML:function(){return this.settings.watch?this.previewContainer.html():(alert("Error: settings.watch == false"),!1)},watch:function(e){var r=this.settings;if(t.inArray(r.mode,["gfm","markdown"])<0)return this;if(this.state.watching=r.watch=!0,this.preview.show(),this.toolbar){var i=r.toolbarIconsClass.watch,o=r.toolbarIconsClass.unwatch,a=this.toolbar.find(".fa[name=watch]");a.parent().attr("title",r.lang.toolbar.watch),a.removeClass(o).addClass(i)}return this.codeMirror.css("border-right","1px solid #ddd").width(this.editor.width()/2),n=0,this.save().resize(),r.onwatch||(r.onwatch=e||function(){}),t.proxy(r.onwatch,this)(),this},unwatch:function(e){var r=this.settings;if(this.state.watching=r.watch=!1,this.preview.hide(),this.toolbar){var n=r.toolbarIconsClass.watch,i=r.toolbarIconsClass.unwatch,o=this.toolbar.find(".fa[name=watch]");o.parent().attr("title",r.lang.toolbar.unwatch),o.removeClass(n).addClass(i)}return this.codeMirror.css("border-right","none").width(this.editor.width()),this.resize(),r.onunwatch||(r.onunwatch=e||function(){}),t.proxy(r.onunwatch,this)(),this},show:function(e){e=e||function(){};var r=this;return this.editor.show(0,function(){t.proxy(e,r)()}),this},hide:function(e){e=e||function(){};var r=this;return this.editor.hide(0,function(){t.proxy(e,r)()}),this},previewing:function(){var e=this,n=this.editor,i=this.preview,o=this.toolbar,a=this.settings,s=this.codeMirror,l=this.previewContainer;if(t.inArray(a.mode,["gfm","markdown"])<0)return this;a.toolbar&&o&&(o.toggle(),o.find(".fa[name=preview]").toggleClass("active")),s.toggle();var c=function(t){t.shiftKey&&27===t.keyCode&&e.previewed()};"none"===s.css("display")?(this.state.preview=!0,this.state.fullscreen&&i.css("background","#fff"),n.find("."+this.classPrefix+"preview-close-btn").show().bind(r.mouseOrTouch("click","touchend"),function(){e.previewed()}),a.watch?l.css("padding",""):this.save(),l.addClass(this.classPrefix+"preview-active"),i.show().css({position:"",top:0,width:n.width(),height:a.autoHeight&&!this.state.fullscreen?"auto":n.height()}),this.state.loaded&&t.proxy(a.onpreviewing,this)(),t(window).bind("keyup",c)):(t(window).unbind("keyup",c),this.previewed())},previewed:function(){var e=this.editor,n=this.preview,i=this.toolbar,o=this.settings,a=this.previewContainer,s=e.find("."+this.classPrefix+"preview-close-btn");return this.state.preview=!1,this.codeMirror.show(),o.toolbar&&i.show(),n[o.watch?"show":"hide"](),s.hide().unbind(r.mouseOrTouch("click","touchend")),a.removeClass(this.classPrefix+"preview-active"),o.watch&&a.css("padding","20px"),n.css({background:null,position:"absolute",width:e.width()/2,height:o.autoHeight&&!this.state.fullscreen?"auto":e.height()-i.height(),top:o.toolbar?i.height():0}),this.state.loaded&&t.proxy(o.onpreviewed,this)(),this},fullscreen:function(){var e=this,r=this.state,n=this.editor,i=(this.preview,this.toolbar),o=this.settings,a=this.classPrefix+"fullscreen";i&&i.find(".fa[name=fullscreen]").parent().toggleClass("active");var s=function(t){t.shiftKey||27!==t.keyCode||r.fullscreen&&e.fullscreenExit()};return n.hasClass(a)?(t(window).unbind("keyup",s),this.fullscreenExit()):(r.fullscreen=!0,t("html,body").css("overflow","hidden"),n.css({width:t(window).width(),height:t(window).height()}).addClass(a),this.resize(),t.proxy(o.onfullscreen,this)(),t(window).bind("keyup",s)),this},fullscreenExit:function(){var e=this.editor,r=this.settings,n=this.toolbar,i=this.classPrefix+"fullscreen";return this.state.fullscreen=!1,n&&n.find(".fa[name=fullscreen]").parent().removeClass("active"),t("html,body").css("overflow",""),e.css({width:e.data("oldWidth"),height:e.data("oldHeight")}).removeClass(i),this.resize(),t.proxy(r.onfullscreenExit,this)(),this},executePlugin:function(e,n){var i=this,o=this.cm;return n=this.settings.pluginPath+n,"function"==typeof define?void 0===this[e]?(alert("Error: "+e+" plugin is not found, you are not load this plugin."),this):(this[e](o),this):(t.inArray(n,r.loadFiles.plugin)<0?r.loadPlugin(n,function(){r.loadPlugins[e]=i[e],i[e](o)}):t.proxy(r.loadPlugins[e],this)(o),this)},search:function(e){var t=this.settings;return t.searchReplace?(t.readOnly||this.cm.execCommand(e||"find"),this):(alert("Error: settings.searchReplace == false"),this)},searchReplace:function(){return this.search("replace"),this},searchReplaceAll:function(){return this.search("replaceAll"),this}},r.fn.init.prototype=r.fn,r.dialogLockScreen=function(){(this.settings||{dialogLockScreen:!0}).dialogLockScreen&&(t("html,body").css("overflow","hidden"),this.resize())},r.dialogShowMask=function(e){var r=this.editor,n=this.settings||{dialogShowMask:!0};e.css({top:(t(window).height()-e.height())/2+"px",left:(t(window).width()-e.width())/2+"px"}),n.dialogShowMask&&r.children("."+this.classPrefix+"mask").css("z-index",parseInt(e.css("z-index"))-1).show()},r.toolbarHandlers={undo:function(){this.cm.undo()},redo:function(){this.cm.redo()},bold:function(){var e=this.cm,t=e.getCursor(),r=e.getSelection();e.replaceSelection("**"+r+"**"),""===r&&e.setCursor(t.line,t.ch+2)},del:function(){var e=this.cm,t=e.getCursor(),r=e.getSelection();e.replaceSelection("~~"+r+"~~"),""===r&&e.setCursor(t.line,t.ch+2)},italic:function(){var e=this.cm,t=e.getCursor(),r=e.getSelection();e.replaceSelection("*"+r+"*"),""===r&&e.setCursor(t.line,t.ch+1)},quote:function(){var e=this.cm,t=e.getCursor(),r=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection("> "+r),e.setCursor(t.line,t.ch+2)):e.replaceSelection("> "+r)},ucfirst:function(){var e=this.cm,t=e.getSelection(),n=e.listSelections();e.replaceSelection(r.firstUpperCase(t)),e.setSelections(n)},ucwords:function(){var e=this.cm,t=e.getSelection(),n=e.listSelections();e.replaceSelection(r.wordsFirstUpperCase(t)),e.setSelections(n)},uppercase:function(){var e=this.cm,t=e.getSelection(),r=e.listSelections();e.replaceSelection(t.toUpperCase()),e.setSelections(r)},lowercase:function(){var e=this.cm,t=(e.getCursor(),e.getSelection()),r=e.listSelections();e.replaceSelection(t.toLowerCase()),e.setSelections(r)},h1:function(){var e=this.cm,t=e.getCursor(),r=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection("# "+r),e.setCursor(t.line,t.ch+2)):e.replaceSelection("# "+r)},h2:function(){var e=this.cm,t=e.getCursor(),r=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection("## "+r),e.setCursor(t.line,t.ch+3)):e.replaceSelection("## "+r)},h3:function(){var e=this.cm,t=e.getCursor(),r=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection("### "+r),e.setCursor(t.line,t.ch+4)):e.replaceSelection("### "+r)},h4:function(){var e=this.cm,t=e.getCursor(),r=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection("#### "+r),e.setCursor(t.line,t.ch+5)):e.replaceSelection("#### "+r)},h5:function(){var e=this.cm,t=e.getCursor(),r=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection("##### "+r),e.setCursor(t.line,t.ch+6)):e.replaceSelection("##### "+r)},h6:function(){var e=this.cm,t=e.getCursor(),r=e.getSelection();0!==t.ch?(e.setCursor(t.line,0),e.replaceSelection("###### "+r),e.setCursor(t.line,t.ch+7)):e.replaceSelection("###### "+r)},"list-ul":function(){var e=this.cm,t=(e.getCursor(),e.getSelection());if(""===t)e.replaceSelection("- "+t);else{for(var r=t.split("\n"),n=0,i=r.length;n<i;n++)r[n]=""===r[n]?"":"- "+r[n];e.replaceSelection(r.join("\n"))}},"list-ol":function(){var e=this.cm,t=(e.getCursor(),e.getSelection());if(""===t)e.replaceSelection("1. "+t);else{for(var r=t.split("\n"),n=0,i=r.length;n<i;n++)r[n]=""===r[n]?"":n+1+". "+r[n];e.replaceSelection(r.join("\n"))}},hr:function(){var e=this.cm,t=e.getCursor();e.getSelection();e.replaceSelection((0!==t.ch?"\n\n":"\n")+"------------\n\n")},tex:function(){if(!this.settings.tex)return alert("settings.tex === false"),this;var e=this.cm,t=e.getCursor(),r=e.getSelection();e.replaceSelection("$$"+r+"$$"),""===r&&e.setCursor(t.line,t.ch+2)},link:function(){this.executePlugin("linkDialog","link-dialog/link-dialog")},"reference-link":function(){this.executePlugin("referenceLinkDialog","reference-link-dialog/reference-link-dialog")},pagebreak:function(){if(!this.settings.pageBreak)return alert("settings.pageBreak === false"),this;var e=this.cm;e.getSelection();e.replaceSelection("\r\n[========]\r\n")},image:function(){this.executePlugin("imageDialog","image-dialog/image-dialog")},code:function(){var e=this.cm,t=e.getCursor(),r=e.getSelection();e.replaceSelection("`"+r+"`"),""===r&&e.setCursor(t.line,t.ch+1)},"code-block":function(){this.executePlugin("codeBlockDialog","code-block-dialog/code-block-dialog")},"preformatted-text":function(){this.executePlugin("preformattedTextDialog","preformatted-text-dialog/preformatted-text-dialog")},table:function(){this.executePlugin("tableDialog","table-dialog/table-dialog")},datetime:function(){var e=this.cm,t=(e.getSelection(),new Date,this.settings.lang.name),n=r.dateFormat()+" "+r.dateFormat("zh-cn"===t||"zh-tw"===t?"cn-week-day":"week-day");e.replaceSelection(n)},emoji:function(){this.executePlugin("emojiDialog","emoji-dialog/emoji-dialog")},"html-entities":function(){this.executePlugin("htmlEntitiesDialog","html-entities-dialog/html-entities-dialog")},"goto-line":function(){this.executePlugin("gotoLineDialog","goto-line-dialog/goto-line-dialog")},watch:function(){this[this.settings.watch?"unwatch":"watch"]()},preview:function(){this.previewing()},fullscreen:function(){this.fullscreen()},clear:function(){this.clear()},search:function(){this.search()},help:function(){this.executePlugin("helpDialog","help-dialog/help-dialog")},info:function(){this.showInfoDialog()}};var o=navigator.platform.toUpperCase().indexOf("MAC")>=0,a=o?"Cmd":"Ctrl";r.keyMaps=(e={},_defineProperty(e,a+"-1","h1"),_defineProperty(e,a+"-2","h2"),_defineProperty(e,a+"-3","h3"),_defineProperty(e,a+"-4","h4"),_defineProperty(e,a+"-5","h5"),_defineProperty(e,a+"-6","h6"),_defineProperty(e,a+"-B","bold"),_defineProperty(e,a+"-D","datetime"),_defineProperty(e,a+"Ctrl-E",function(){var e=this.cm,t=e.getCursor(),r=e.getSelection();if(!this.settings.emoji)return void alert("Error: settings.emoji == false");e.replaceSelection(":"+r+":"),""===r&&e.setCursor(t.line,t.ch+1)}),_defineProperty(e,a+"-Alt-G","goto-line"),_defineProperty(e,a+"-H","hr"),_defineProperty(e,a+"-I","italic"),_defineProperty(e,a+"-K","code"),_defineProperty(e,"Ctrl-L",function(){var e=this.cm,t=e.getCursor(),r=e.getSelection(),n=""===r?"":' "'+r+'"';e.replaceSelection("["+r+"]("+n+")"),""===r&&e.setCursor(t.line,t.ch+1)}),_defineProperty(e,a+"-U","list-ul"),_defineProperty(e,"Shift-Ctrl-A",function(){var e=this.cm,t=e.getCursor(),r=e.getSelection();if(!this.settings.atLink)return void alert("Error: settings.atLink == false");e.replaceSelection("@"+r),""===r&&e.setCursor(t.line,t.ch+1)}),_defineProperty(e,"Shift"+a+"-C","code"),_defineProperty(e,"Shift"+a+"Q","quote"),_defineProperty(e,"Shift"+a+"S","del"),_defineProperty(e,"Shift"+a+"K","tex"),_defineProperty(e,"Shift-Alt-C",function(){var e=this.cm,t=e.getCursor(),r=e.getSelection();e.replaceSelection(["```",r,"```"].join("\n")),""===r&&e.setCursor(t.line,t.ch+3)}),_defineProperty(e,"Shift-"+a+"-Alt-C","code-block"),_defineProperty(e,"Shift-"+a+"-H","html-entities"),_defineProperty(e,"Shift-Alt-H","help"),_defineProperty(e,"Shift-"+a+"-E","emoji"),_defineProperty(e,"Shift-"+a+"-U","uppercase"),_defineProperty(e,"Shift-Alt-U","ucwords"),_defineProperty(e,"Shift-"+a+"-Alt-U","ucfirst"),_defineProperty(e,"Shift-Alt-L","lowercase"),_defineProperty(e,"Shift-"+a+"-I",function(){var e=this.cm,t=e.getCursor(),r=e.getSelection(),n=""===r?"":' "'+r+'"';e.replaceSelection("!["+r+"]("+n+")"),""===r&&e.setCursor(t.line,t.ch+4)}),_defineProperty(e,"Shift-"+a+"-Alt-I","image"),_defineProperty(e,"Shift-"+a+"-L","link"),_defineProperty(e,"Shift-"+a+"-O","list-ol"),_defineProperty(e,"Shift-"+a+"-P","preformatted-text"),_defineProperty(e,"Shift-"+a+"-T","table"),_defineProperty(e,"Shift-Alt-P","pagebreak"),_defineProperty(e,"F9","watch"),_defineProperty(e,"F10","preview"),_defineProperty(e,"F11","fullscreen"),e);var s=function(e){return String.prototype.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};r.trim=s;var l=function(e){return e.toLowerCase().replace(/\b(\w)|\s(\w)/g,function(e){return e.toUpperCase()})};r.ucwords=r.wordsFirstUpperCase=l;var c=function(e){return e.toLowerCase().replace(/\b(\w)/,function(e){return e.toUpperCase()})};return r.firstUpperCase=r.ucfirst=c,r.urls={atLinkBase:"https://github.com/"},r.regexs={atLink:/@(\w+)/g,email:/(\w+)@(\w+)\.(\w+)\.?(\w+)?/g,emailLink:/(mailto:)?([\w\.\_]+)@(\w+)\.(\w+)\.?(\w+)?/g,emoji:/:([\w\+-]+):/g,emojiDatetime:/(\d{1,2}:\d{1,2}:\d{1,2})/g,twemoji:/:(tw-([\w]+)-?(\w+)?):/g,fontAwesome:/:(fa-([\w]+)(-(\w+)){0,}):/g,editormdLogo:/:(editormd-logo-?(\w+)?):/g,pageBreak:/^\[[=]{8,}\]$/},r.emoji={path:"http://www.emoji-cheat-sheet.com/graphics/emojis/",ext:".png"},r.twemoji={path:"http://twemoji.maxcdn.com/36x36/",ext:".png"},r.markedRenderer=function(e,n){var i={toc:!0,tocm:!1,tocStartLevel:1,pageBreak:!0,atLink:!0,emailLink:!0,taskList:!1,emoji:!1,tex:!1,flowChart:!1,sequenceDiagram:!1},o=t.extend(i,n||{}),a=r.$marked,l=new a.Renderer;e=e||[];var c=r.regexs,u=c.atLink,d=c.emoji,f=c.email,m=c.emailLink,h=c.twemoji,p=c.fontAwesome,g=c.editormdLogo,b=c.pageBreak;return l.emoji=function(e){e=e.replace(r.regexs.emojiDatetime,function(e){return e.replace(/:/g,"&#58;")});var t=e.match(d);if(!t||!o.emoji)return e;for(var n=0,i=t.length;n<i;n++)":+1:"===t[n]&&(t[n]=":\\+1:"),e=e.replace(new RegExp(t[n]),function(e,t){var n=e.match(p),i=e.replace(/:/g,"");if(n)for(var o=0,a=n.length;o<a;o++){var s=n[o].replace(/:/g,"");return'<i class="fa '+s+' fa-emoji" title="'+s.replace("fa-","")+'"></i>'}else{var l=e.match(g),c=e.match(h);if(l)for(var u=0,d=l.length;u<d;u++){var f=l[u].replace(/:/g,"");return'<i class="'+f+'" title="Editor.md logo ('+f+')"></i>'}else{if(!c){var m="+1"===i?"plus1":i;return m="black_large_square"===m?"black_square":m,m="moon"===m?"waxing_gibbous_moon":m,'<img src="'+r.emoji.path+m+r.emoji.ext+'" class="emoji" title="&#58;'+i+'&#58;" alt="&#58;'+i+'&#58;" />'}for(var b=0,v=c.length;b<v;b++){var y=c[b].replace(/:/g,"").replace("tw-","");return'<img src="'+r.twemoji.path+y+r.twemoji.ext+'" title="twemoji-'+y+'" alt="twemoji-'+y+'" class="emoji twemoji" />'}}}});return e},l.atLink=function(e){return u.test(e)?(o.atLink&&(e=e.replace(f,function(e,t,r,n){return e.replace(/@/g,"_#_&#64;_#_")}),e=e.replace(u,function(e,t){return'<a href="'+r.urls.atLinkBase+t+'" title="&#64;'+t+'" class="at-link">'+e+"</a>"}).replace(/_#_&#64;_#_/g,"@")),o.emailLink&&(e=e.replace(m,function(e,r,n,i,o){return!r&&t.inArray(o,"jpg|jpeg|png|gif|webp|ico|icon|pdf".split("|"))<0?'<a href="mailto:'+e+'">'+e+"</a>":e})),e):e},l.link=function(e,t,r){if(this.options.sanitize)try{if(0===decodeURIComponent(unescape(e)).replace(/[^\w:]/g,"").toLowerCase().indexOf("javascript:"))return""}catch(e){return""}var n='<a href="'+e+'"';return u.test(t)||u.test(r)?(t&&(n+=' title="'+t.replace(/@/g,"&#64;")),n+'">'+r.replace(/@/g,"&#64;")+"</a>"):(t&&(n+=' title="'+t+'"'),n+=">"+r+"</a>")},l.heading=function(t,r,n){var i=t,o=/\s*<a\s*href\=\"(.*)\"\s*([^\>]*)\>(.*)<\/a\>\s*/;if(o.test(t)){var a=[];t=t.split(/<a\s*([^\>]+)\>([^\>]*)<\/a\>/);for(var l=0,c=t.length;l<c;l++)a.push(t[l].replace(/\s*href\=\"(.*)\"\s*/g,""));t=a.join(" ")}t=s(t);var u=t.toLowerCase().replace(/[^\w]+/g,"-"),d={text:t,level:r,slug:u},f=/^[\u4e00-\u9fa5]+$/.test(t),m=f?escape(t).replace(/\%/g,""):t.toLowerCase().replace(/[^\w]+/g,"-");e.push(d);var h="<h"+r+' id="h'+r+"-"+this.options.headerPrefix+m+'">';return h+='<a name="'+t+'" class="reference-link"></a>',h+='<span class="header-link octicon octicon-link"></span>',h+=o?this.atLink(this.emoji(i)):this.atLink(this.emoji(t)),h+="</h"+r+">"},l.pageBreak=function(e){return b.test(e)&&o.pageBreak&&(e='<hr style="page-break-after:always;" class="page-break editormd-page-break" />'),e},l.paragraph=function(e){var t=/\$\$(.*)\$\$/g.test(e),n=/^\$\$(.*)\$\$$/.test(e),i=n?' class="'+r.classNames.tex+'"':"",a=o.tocm?/^(\[TOC\]|\[TOCM\])$/.test(e):/^\[TOC\]$/.test(e),s=/^\[TOCM\]$/.test(e);e=!n&&t?e.replace(/(\$\$([^\$]*)\$\$)+/g,function(e,t){return'<span class="'+r.classNames.tex+'">'+t.replace(/\$/g,"")+"</span>"}):n?e.replace(/\$/g,""):e;var l='<div class="markdown-toc editormd-markdown-toc">'+e+"</div>";return a?s?'<div class="editormd-toc-menu">'+l+"</div><br/>":l:b.test(e)?this.pageBreak(e):"<p"+i+">"+this.atLink(this.emoji(e))+"</p>\n"},l.code=function(e,t,n){return"seq"===t||"sequence"===t?'<div class="sequence-diagram">'+e+"</div>":"flow"===t?'<div class="flowchart">'+e+"</div>":"math"===t||"latex"===t||"katex"===t?'<p class="'+r.classNames.tex+'">'+e+"</p>":a.Renderer.prototype.code.apply(this,arguments)},l.tablecell=function(e,t){var r=t.header?"th":"td";return(t.align?"<"+r+' style="text-align:'+t.align+'">':"<"+r+">")+this.atLink(this.emoji(e))+"</"+r+">\n"},l.listitem=function(e){return o.taskList&&/^\s*\[[x\s]\]\s*/.test(e)?(e=e.replace(/^\s*\[\s\]\s*/,'<input type="checkbox" class="task-list-item-checkbox" /> ').replace(/^\s*\[x\]\s*/,'<input type="checkbox" class="task-list-item-checkbox" checked disabled /> '),'<li style="list-style: none;">'+this.atLink(this.emoji(e))+"</li>"):"<li>"+this.atLink(this.emoji(e))+"</li>"},l},r.markdownToCRenderer=function(e,t,r,n){var i="",o=[0],a=this.classPrefix;n=n||1;for(var s=0,l=e.length;s<l;s++){var c=e[s].text,u=e[s].level,d=o.length,f=o[d-1],m=0;if(!(u<n)){if(u>f)i+="",o.push(u);else if(u<f){for(var h=d-1;h>=0;h--){if(!(u<=o[h])){o.push(u);break}m++,o.pop()}i+=new Array(m+1).join("</ul></li>")}else i+="</ul></li>";i+='<li><a class="toc-level-'+u+'" href="#'+c+'" level="'+u+'">'+c+"</a><ul>"}}var p=t.find(".markdown-toc");if(p.length<1&&"false"===t.attr("previewContainer")){var g='<div class="markdown-toc '+a+'markdown-toc"></div>';g=r?'<div class="'+a+'toc-menu">'+g+"</div>":g,t.html(g),p=t.find(".markdown-toc")}return r&&p.wrap('<div class="'+a+'toc-menu"></div><br/>'),p.html('<ul class="markdown-toc-list"></ul>').children(".markdown-toc-list").html(i.replace(/\r?\n?<ul\><\/ul\>/g,"")),p},r.tocDropdownMenu=function(e,r){r=r||"Table of Contents";var n=400,i=e.find("."+this.classPrefix+"toc-menu");return i.each(function(){var e=t(this),i=e.children(".markdown-toc"),o='<i class="fa fa-angle-down"></i>',a='<a href="javascript:;" class="toc-menu-btn">'+o+r+"</a>",s=i.children("ul"),l=s.find("li");i.append(a),l.first().before("<li><h1>"+r+" "+o+"</h1></li>"),e.mouseover(function(){s.show(),l.each(function(){var e=t(this),r=e.children("ul");if(""===r.html()&&r.remove(),r.length>0&&""!==r.html()){var i=e.children("a").first();i.children(".fa").length<1&&i.append(t(o).css({float:"right",paddingTop:"4px"}))}e.mouseover(function(){r.css("z-index",n).show(),n+=1}).mouseleave(function(){r.hide()})})}).mouseleave(function(){s.hide()})}),i},r.filterHTMLTags=function(e,r){if("string"!=typeof e&&(e=new String(e)),"string"!=typeof r)return e;for(var n=r.split("|"),i=n[0].split(","),o=n[1],a=0,s=i.length;a<s;a++){var l=i[a];e=e.replace(new RegExp("<s*"+l+"s*([^>]*)>([^>]*)<s*/"+l+"s*>","igm"),"")}if(void 0!==o){var c=/<(\w+)\s*([^\>]*)\>([^\>]*)<\/(\w+)\>/gi;e="*"===o?e.replace(c,function(e,t,r,n,i){return"<"+t+">"+n+"</"+i+">"}):"on*"===o?e.replace(c,function(e,r,n,i,o){var a=t("<"+r+">"+i+"</"+o+">"),s=t(e)[0].attributes,l={};t.each(s,function(e,t){'"'!==t.nodeName&&(l[t.nodeName]=t.nodeValue,"href"===t.nodeName&&t.nodeValue.toLowerCase().indexOf("javascript:")>=0&&(l[t.nodeName]="javascript:;"))}),t.each(l,function(e){0===e.indexOf("on")&&delete l[e]}),a.attr(l);var c=void 0!==a[1]?t(a[1]).text():"";if(!r||isNaN(r)||r===o)return r&&isNaN(r)&&r!==o?(c+="</"+o+">",a[0].outerHTML+c):a[0].outerHTML+c;c+="<"+r+">"+i+"</"+o+">"}):e.replace(c,function(e,r,n,i){var a=o.split(","),s=t(e);return s.html(i),t.each(a,function(e){s.attr(a[e],null)}),s[0].outerHTML})}return e},r.markdownToHTML=function(e,n){var i={gfm:!0,toc:!0,tocm:!1,tocStartLevel:1,tocTitle:"目录",tocDropdown:!1,tocContainer:"",markdown:"",markdownSourceCode:!1,htmlDecode:!1,autoLoadKaTeX:!0,pageBreak:!0,atLink:!0,emailLink:!0,tex:!1,taskList:!1,emoji:!1,flowChart:!1,sequenceDiagram:!1,previewCodeHighlight:!0};r.$marked=marked;var o=t("#"+e),a=o.settings=t.extend(!0,i,n||{}),s=o.find("textarea");s.length<1&&(o.append("<textarea></textarea>"),s=o.find("textarea"));var l=""===a.markdown?s.val():a.markdown,c=[],u={toc:a.toc,tocm:a.tocm,tocStartLevel:a.tocStartLevel,taskList:a.taskList,emoji:a.emoji,tex:a.tex,pageBreak:a.pageBreak,atLink:a.atLink,emailLink:a.emailLink,flowChart:a.flowChart,sequenceDiagram:a.sequenceDiagram,previewCodeHighlight:a.previewCodeHighlight},d={renderer:r.markedRenderer(c,u),gfm:a.gfm,tables:!0,breaks:!0,pedantic:!1,sanitize:!a.htmlDecode,smartLists:!0,smartypants:!0};l=new String(l);var f=marked(l,d);f=r.filterHTMLTags(f,a.htmlDecode),a.markdownSourceCode?s.text(l):s.remove(),o.addClass("markdown-body "+this.classPrefix+"html-preview").append(f);var m=""!==a.tocContainer?t(a.tocContainer):o;if(""!==a.tocContainer&&m.attr("previewContainer",!1),a.toc&&(o.tocContainer=this.markdownToCRenderer(c,m,a.tocDropdown,a.tocStartLevel),(a.tocDropdown||o.find("."+this.classPrefix+"toc-menu").length>0)&&this.tocDropdownMenu(o,a.tocTitle),""!==a.tocContainer&&o.find(".editormd-toc-menu, .editormd-markdown-toc").remove()),a.previewCodeHighlight&&(o.find("pre").addClass("prettyprint linenums"),prettyPrint()),r.isIE8||(a.flowChart&&o.find(".flowchart").flowChart(),a.sequenceDiagram&&o.find(".sequence-diagram").sequenceDiagram({theme:"simple"})),a.tex){var h=function(){o.find("."+r.classNames.tex).each(function(){var e=t(this);katex.render(e.html().replace(/&lt;/g,"<").replace(/&gt;/g,">"),e[0]),e.find(".katex").css("font-size","1.6em")})};!a.autoLoadKaTeX||r.$katex||r.kaTeXLoaded?h():this.loadKaTeX(function(){r.$katex=katex,r.kaTeXLoaded=!0,h()})}return o.getMarkdown=function(){return s.val()},o},r.themes=["default","dark"],r.previewThemes=["default","dark"],r.editorThemes=["default","3024-day","3024-night","ambiance","ambiance-mobile","base16-dark","base16-light","blackboard","cobalt","eclipse","elegant","erlang-dark","lesser-dark","mbo","mdn-like","midnight","monokai","neat","neo","night","paraiso-dark","paraiso-light","pastel-on-dark","rubyblue","solarized","the-matrix","tomorrow-night-eighties","twilight","vibrant-ink","xq-dark","xq-light"],r.loadPlugins={},r.loadFiles={js:[],css:[],plugin:[]},r.loadPlugin=function(e,t,n){t=t||function(){},this.loadScript(e,function(){r.loadFiles.plugin.push(e),t()},n)},r.loadCSS=function(e,t,n){n=n||"head",t=t||function(){};var i=document.createElement("link");i.type="text/css",i.rel="stylesheet",i.onload=i.onreadystatechange=function(){r.loadFiles.css.push(e),t()},i.href=e+".css","head"===n?document.getElementsByTagName("head")[0].appendChild(i):document.body.appendChild(i)},r.isIE="Microsoft Internet Explorer"===navigator.appName,r.isIE8=r.isIE&&"8."===navigator.appVersion.match(/8./i),r.loadScript=function(e,t,n){n=n||"head",t=t||function(){};var i=null;i=document.createElement("script"),i.id=e.replace(/[\.\/]+/g,"-"),i.type="text/javascript",i.src=e+".js",r.isIE8?i.onreadystatechange=function(){i.readyState&&("loaded"!==i.readyState&&"complete"!==i.readyState||(i.onreadystatechange=null,r.loadFiles.js.push(e),t()))}:i.onload=function(){r.loadFiles.js.push(e),t()},"head"===n?document.getElementsByTagName("head")[0].appendChild(i):document.body.appendChild(i)},r.katexURL={css:"//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min",js:"//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min"},r.kaTeXLoaded=!1,r.loadKaTeX=function(e){r.loadCSS(r.katexURL.css,function(){r.loadScript(r.katexURL.js,e||function(){})})},r.lockScreen=function(e){t("html,body").css("overflow",e?"hidden":"")},r.createDialog=function(e){var n={name:"",width:420,height:240,title:"",drag:!0,closed:!0,content:"",mask:!0,maskStyle:{backgroundColor:"#fff",opacity:.1},lockScreen:!0,footer:!0,buttons:!1};e=t.extend(!0,n,e);var i=this,o=this.editor,a=r.classPrefix,s=(new Date).getTime(),l=""===e.name?a+"dialog-"+s:e.name,c=r.mouseOrTouch,u='<div class="'+a+"dialog "+l+'">';""!==e.title&&(u+='<div class="'+a+'dialog-header"'+(e.drag?' style="cursor: move;"':"")+">",u+='<strong class="'+a+'dialog-title">'+e.title+"</strong>",u+="</div>"),e.closed&&(u+='<a href="javascript:;" class="fa fa-close '+a+'dialog-close"></a>'),u+='<div class="'+a+'dialog-container">'+e.content,(e.footer||"string"==typeof e.footer)&&(u+='<div class="'+a+'dialog-footer">'+("boolean"==typeof e.footer?"":e.footer)+"</div>"),u+="</div>",u+='<div class="'+a+"dialog-mask "+a+'dialog-mask-bg"></div>',u+='<div class="'+a+"dialog-mask "+a+'dialog-mask-con"></div>',u+="</div>",o.append(u);var d=o.find("."+l);d.lockScreen=function(r){return e.lockScreen&&(t("html,body").css("overflow",r?"hidden":""),i.resize()),d},d.showMask=function(){return e.mask&&o.find("."+a+"mask").css(e.maskStyle).css("z-index",r.dialogZindex-1).show(),d},d.hideMask=function(){return e.mask&&o.find("."+a+"mask").hide(),d},d.loading=function(e){return d.find("."+a+"dialog-mask")[e?"show":"hide"](),d},d.lockScreen(!0).showMask(),d.show().css({zIndex:r.dialogZindex,border:r.isIE8?"1px solid #ddd":"",width:"number"==typeof e.width?e.width+"px":e.width,height:"number"==typeof e.height?e.height+"px":e.height});var f=function(){d.css({top:(t(window).height()-d.height())/2+"px",left:(t(window).width()-d.width())/2+"px"})};if(f(),t(window).resize(f),d.children("."+a+"dialog-close").bind(c("click","touchend"),function(){d.hide().lockScreen(!1).hideMask()}),"object"===_typeof(e.buttons)){var m=d.footer=d.find("."+a+"dialog-footer");for(var h in e.buttons){var p=e.buttons[h],g=a+h+"-btn";m.append('<button class="'+a+"btn "+g+'">'+p[0]+"</button>"),p[1]=t.proxy(p[1],d),m.children("."+g).bind(c("click","touchend"),p[1])}}if(""!==e.title&&e.drag){var b,v,y=d.children("."+a+"dialog-header");e.mask||y.bind(c("click","touchend"),function(){r.dialogZindex+=2,d.css("z-index",r.dialogZindex)});var x=function(e){e.removeClass(a+"user-unselect").off("selectstart")},k=function(e){e.addClass(a+"user-unselect").on("selectstart",function(e){return!1})},_=function(e){e=e||window.event;var r,n,i=parseInt(d[0].style.left),o=parseInt(d[0].style.top);i>=0?i+d.width()<=t(window).width()?r=e.clientX-b:(r=t(window).width()-d.width(),document.onmousemove=null):(r=0,document.onmousemove=null),o>=0?n=e.clientY-v:(n=0,document.onmousemove=null),document.onselectstart=function(){return!1},k(t("body")),k(d),d[0].style.left=r+"px",d[0].style.top=n+"px"};y.mousedown(function(e){e=e||window.event,b=e.clientX-parseInt(d[0].style.left),v=e.clientY-parseInt(d[0].style.top),document.onmousemove=_}),document.onmouseup=function(){x(t("body")),x(d),document.onselectstart=null,document.onmousemove=null},y.touchDraggable=function(){var e=null,r=function(r){var n=r.originalEvent,i=t(this).parent().position();e={x:n.changedTouches[0].pageX-i.left,y:n.changedTouches[0].pageY-i.top}},n=function(r){r.preventDefault();var n=r.originalEvent;t(this).parent().css({top:n.changedTouches[0].pageY-e.y,left:n.changedTouches[0].pageX-e.x})};this.bind("touchstart",r).bind("touchmove",n)},y.touchDraggable()}return r.dialogZindex+=2,d},r.mouseOrTouch=function(e,t){e=e||"click",t=t||"touchend";var r=e;try{document.createEvent("TouchEvent"),r=t}catch(e){}return r},r.dateFormat=function(e){e=e||"";var t=function(e){return e<10?"0"+e:e},r=new Date,n=r.getFullYear(),i=n.toString().slice(2,4),o=t(r.getMonth()+1),a=t(r.getDate()),s=r.getDay(),l=t(r.getHours()),c=t(r.getMinutes()),u=t(r.getSeconds()),d=t(r.getMilliseconds()),f="",m=i+"-"+o+"-"+a,h=n+"-"+o+"-"+a,p=l+":"+c+":"+u;switch(e){case"UNIX Time":f=r.getTime();break;case"UTC":f=r.toUTCString();break;case"yy":f=i;break;case"year":case"yyyy":f=n;break;case"month":case"mm":f=o;break;case"cn-week-day":case"cn-wd":f="星期"+["日","一","二","三","四","五","六"][s];break;case"week-day":case"wd":f=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][s];break;case"day":case"dd":f=a;break;case"hour":case"hh":f=l;break;case"min":case"ii":f=c;break;case"second":case"ss":f=u;break;case"ms":f=d;break;case"yy-mm-dd":f=m;break;case"yyyy-mm-dd":f=h;break;case"yyyy-mm-dd h:i:s ms":case"full + ms":f=h+" "+p+" "+d;break;case"full":case"yyyy-mm-dd h:i:s":break;default:f=h+" "+p}return f},r}});